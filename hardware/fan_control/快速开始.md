# ç¡¬ä»¶é£æ‰‡æ§åˆ¶æ¨¡å— - å¿«é€Ÿå¼€å§‹

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

```
hardware/
â””â”€â”€ fan_control/
    â”œâ”€â”€ __init__.py                    # æ¨¡å—åˆå§‹åŒ–
    â”œâ”€â”€ config.py                      # é…ç½®ç®¡ç†
    â”œâ”€â”€ modbus_fan.py                  # Modbusé£æ‰‡æ§åˆ¶å™¨
    â”œâ”€â”€ fan_encoder.py                 # é£æ‰‡é€Ÿåº¦ç¼–ç å™¨
    â”œâ”€â”€ examples.py                    # ä½¿ç”¨ç¤ºä¾‹ï¼ˆ10ä¸ªç¤ºä¾‹ï¼‰
    â”œâ”€â”€ test_fan_control.py            # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ wind_field_integration.py      # é£åœºé›†æˆç¤ºä¾‹
    â”œâ”€â”€ README.md                      # è¯¦ç»†æ–‡æ¡£
    â””â”€â”€ å¿«é€Ÿå¼€å§‹.md                    # æœ¬æ–‡ä»¶
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. Modbus RTUåè®®æ”¯æŒ
- âœ… é€šè¿‡ç½‘ç»œsocketé€šä¿¡
- âœ… æ”¯æŒå†™å•ä¸ª/å¤šä¸ªå¯„å­˜å™¨
- âœ… CRCæ ¡éªŒå’Œé”™è¯¯å¤„ç†
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶

### 2. é£æ‰‡é€Ÿåº¦æ§åˆ¶
- âœ… å•é£æ‰‡æ§åˆ¶
- âœ… æ‰¹é‡é£æ‰‡æ§åˆ¶
- âœ… å­—å…¸æ–¹å¼æ§åˆ¶
- âœ… å¿«æ·æ§åˆ¶å‡½æ•°

### 3. é£åœºæ•°æ®ç¼–ç 
- âœ… 40x40ç½‘æ ¼ä¸‹é‡‡æ ·åˆ°é£æ‰‡å¸ƒå±€
- âœ… æ¸å˜æ¨¡å¼ç”Ÿæˆ
- âœ… å¾„å‘æ¨¡å¼ç”Ÿæˆ
- âœ… æ³¢æµªåŠ¨ç”»æ¨¡å¼
- âœ… é«˜çº§åˆ†åŒºç¼–ç 

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ–¹å¼1: å¿«é€Ÿæ§åˆ¶ï¼ˆæœ€ç®€å•ï¼‰

```python
from hardware.fan_control import quick_control_all_fans

# è®¾ç½®æ‰€æœ‰é£æ‰‡ä¸º50%
quick_control_all_fans(50.0, device_ip="192.168.2.1")
```

### æ–¹å¼2: æ ‡å‡†æ§åˆ¶

```python
from hardware.fan_control import ModbusFanController, FanConfig

# åˆ›å»ºé…ç½®å’Œæ§åˆ¶å™¨
config = FanConfig(device_ip="192.168.2.1")

with ModbusFanController(config) as controller:
    # è®¾ç½®æ‰€æœ‰é£æ‰‡ä¸º75%
    controller.set_all_fans_speed(75.0)

    # ç­‰å¾…2ç§’
    time.sleep(2)

    # åœæ­¢æ‰€æœ‰é£æ‰‡
    controller.stop_all_fans()
```

### æ–¹å¼3: é£åœºæ•°æ®é›†æˆ

```python
import numpy as np
from hardware.fan_control import WindFieldFanController

# åˆ›å»ºé£åœºæ§åˆ¶å™¨
fan_ctrl = WindFieldFanController()

# è¿æ¥
if fan_ctrl.connect():
    try:
        # åˆ›å»ºé£åœºæ•°æ®ï¼ˆ40x40ï¼‰
        grid_data = np.random.rand(40, 40) * 100

        # åº”ç”¨åˆ°é£æ‰‡
        fan_ctrl.apply_wind_field(grid_data)

        # æŸ¥çœ‹å½“å‰é€Ÿåº¦
        fan_ctrl.print_current_speeds()

        time.sleep(3)

    finally:
        fan_ctrl.stop_all()
        fan_ctrl.disconnect()
```

## ğŸ“š è¿è¡Œç¤ºä¾‹

### è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
```bash
cd hardware/fan_control
python test_fan_control.py
```
é¢„æœŸç»“æœ: âœ… 26ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### è¿è¡ŒåŸºç¡€ç¤ºä¾‹
```bash
python examples.py
```
é€‰æ‹©1-10è¿è¡Œä¸åŒçš„ç¤ºä¾‹ï¼š
1. åŸºç¡€é£æ‰‡æ§åˆ¶
2. åˆ†åˆ«æ§åˆ¶æ¯ä¸ªé£æ‰‡
3. ä½¿ç”¨å­—å…¸æ§åˆ¶ç‰¹å®šé£æ‰‡
4. å¿«é€Ÿæ§åˆ¶å‡½æ•°
5. é£åœºæ•°æ®é›†æˆ
6. ç”Ÿæˆå„ç§é£æ‰‡æ¨¡å¼
7. é£æ‰‡åŠ¨ç”»æ•ˆæœ
8. é”™è¯¯å¤„ç†å’Œé‡è¿
9. è‡ªå®šä¹‰é…ç½®
10. æ‰¹é‡æ§åˆ¶å¤šä¸ªæ¿å­

### è¿è¡Œé£åœºé›†æˆæ¼”ç¤º
```bash
python wind_field_integration.py
```
é€‰æ‹©1-5è¿è¡Œä¸åŒçš„æ¼”ç¤ºï¼š
1. åŸºç¡€ä½¿ç”¨
2. å‡½æ•°æ¨¡å¼
3. åŠ¨ç”»æ•ˆæœ
4. æŒç»­æ§åˆ¶
5. è‡ªå®šä¹‰å¸ƒå±€

## ğŸ”§ é…ç½®è¯´æ˜

### é»˜è®¤é…ç½®ï¼ˆç¬¬ä¸€å—æ¿å­ï¼‰
- è®¾å¤‡IP: `192.168.2.1`
- ç«¯å£: `8234`
- ä»ç«™åœ°å€: `1`
- é£æ‰‡æ•°é‡: `16`
- PWMèŒƒå›´: `0-1000`

### ä¿®æ”¹é…ç½®
```python
from hardware.fan_control import FanConfig

# è‡ªå®šä¹‰é…ç½®
config = FanConfig(
    device_ip="192.168.2.1",    # ä¿®æ”¹IP
    fan_count=32,               # 32ä¸ªé£æ‰‡
    pwm_max=2000,               # PWMæœ€å¤§å€¼2000
    timeout=10.0,               # 10ç§’è¶…æ—¶
)
```

## ğŸ“Š å¯„å­˜å™¨æ˜ å°„

| é£æ‰‡ç¼–å· | å¯„å­˜å™¨åœ°å€ | PWMå€¼ | å®é™…é€Ÿåº¦ |
|----------|------------|-------|----------|
| é£æ‰‡1    | 0x0000     | 0     | 0%       |
| é£æ‰‡1    | 0x0000     | 500   | 50%      |
| é£æ‰‡1    | 0x0000     | 1000  | 100%     |
| é£æ‰‡2    | 0x0001     | ...   | ...      |
| ...      | ...        | ...   | ...      |

## ğŸ¨ é¢„è®¾æ¨¡å¼

### 1. æ¸å˜æ¨¡å¼
```python
from hardware.fan_control import PresetEncoders

encoder = PresetEncoders.STANDARD_4X4

# å¯¹è§’çº¿æ¸å˜: 0% -> 100%
speeds = encoder.create_gradient_pattern('diagonal', 0, 100)

# æ°´å¹³æ¸å˜
speeds = encoder.create_gradient_pattern('horizontal', 0, 100)

# å‚ç›´æ¸å˜
speeds = encoder.create_gradient_pattern('vertical', 0, 100)
```

### 2. å¾„å‘æ¨¡å¼
```python
# ä¸­å¿ƒ100%ï¼Œè¾¹ç¼˜0%
speeds = encoder.create_radial_pattern(center_speed=100, edge_speed=0)
```

### 3. æ³¢æµªæ¨¡å¼
```python
# æ—¶é—´=0çš„æ³¢æµª
speeds = encoder.create_wave_pattern(time=0.0, frequency=2.0, amplitude=50.0)

# æ—¶é—´=1çš„æ³¢æµªï¼ˆåŠ¨ç”»ï¼‰
speeds = encoder.create_wave_pattern(time=1.0, frequency=2.0, amplitude=50.0)
```

## ğŸ”— ä¸é£åœºç¼–è¾‘å™¨é›†æˆ

### é›†æˆåˆ°ä¸»çª—å£

åœ¨`main_window.py`ä¸­æ·»åŠ é£æ‰‡æ§åˆ¶åŠŸèƒ½ï¼š

```python
from hardware.fan_control import WindFieldFanController

class MainWindow(QMainWindow):
    def __init__(self):
        # ... åŸæœ‰ä»£ç  ...

        # åˆ›å»ºé£æ‰‡æ§åˆ¶å™¨
        self.fan_controller = WindFieldFanController()
        self.fan_controller.connect()

    def _apply_to_fans(self, grid_data):
        """åº”ç”¨é£åœºæ•°æ®åˆ°é£æ‰‡"""
        if self.fan_controller.is_connected:
            self.fan_controller.apply_wind_field(grid_data)

    def closeEvent(self, event):
        """å…³é—­æ—¶æ–­å¼€è¿æ¥"""
        self.fan_controller.disconnect()
        super().closeEvent(event)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¿æ¥**
   - ç¡®ä¿é£æ‰‡æ§åˆ¶å™¨IPé…ç½®æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

2. **å¯„å­˜å™¨é…ç½®**
   - æ ¹æ®å®é™…è®¾å¤‡è°ƒæ•´å¯„å­˜å™¨èµ·å§‹åœ°å€
   - ç¡®è®¤ä»ç«™åœ°å€é…ç½®

3. **PWMèŒƒå›´**
   - é»˜è®¤0-1000å¯¹åº”0%-100%
   - æ ¹æ®è®¾å¤‡è§„æ ¼è°ƒæ•´

4. **é”™è¯¯å¤„ç†**
   - å»ºè®®ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆwithè¯­å¥ï¼‰
   - æ£€æŸ¥è¿æ¥çŠ¶æ€åå†å‘é€å‘½ä»¤

## ğŸ“ æ•…éšœæ’é™¤

### é—®é¢˜1: è¿æ¥å¤±è´¥
```
âŒ è¿æ¥å¤±è´¥: è®¾å¤‡æ‹’ç»è¿æ¥
```
è§£å†³æ–¹æ¡ˆ:
- æ£€æŸ¥IPåœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®è®¤è®¾å¤‡åœ¨çº¿
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤8234ï¼‰

### é—®é¢˜2: å‘½ä»¤è¶…æ—¶
```
âŒ é€šä¿¡è¶…æ—¶
```
è§£å†³æ–¹æ¡ˆ:
- å¢åŠ timeoutå‚æ•°å€¼
- æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
- å‡å°‘é€šä¿¡é¢‘ç‡

### é—®é¢˜3: é£æ‰‡ä¸å“åº”
```
âŒ è®¾ç½®å¤±è´¥ - CRCæ ¡éªŒå¤±è´¥
```
è§£å†³æ–¹æ¡ˆ:
- æ£€æŸ¥ä»ç«™åœ°å€é…ç½®
- ç¡®è®¤è®¾å¤‡æ”¯æŒModbus RTU
- æ£€æŸ¥å¯„å­˜å™¨åœ°å€èŒƒå›´

## ğŸ“– æ›´å¤šæ–‡æ¡£

- è¯¦ç»†APIæ–‡æ¡£: `README.md`
- ä»£ç ç¤ºä¾‹: `examples.py`
- é›†æˆç¤ºä¾‹: `wind_field_integration.py`

## âœ… æµ‹è¯•éªŒè¯

æ‰€æœ‰26ä¸ªå•å…ƒæµ‹è¯•é€šè¿‡ï¼š
```
============================================================
æµ‹è¯•æ€»ç»“
============================================================
è¿è¡Œæµ‹è¯•: 26
æˆåŠŸ: 26
å¤±è´¥: 0
é”™è¯¯: 0
============================================================
```

## ğŸ‰ å¼€å§‹ä½¿ç”¨

é€‰æ‹©ä¸€ç§æ–¹å¼å¼€å§‹ï¼š

1. **æœ€ç®€å•**: è¿è¡Œ`python examples.py`ï¼Œé€‰æ‹©ç¤ºä¾‹4ä½“éªŒå¿«é€Ÿæ§åˆ¶
2. **å­¦ä¹ **: è¿è¡Œ`python wind_field_integration.py`ï¼ŒæŸ¥çœ‹é£åœºé›†æˆ
3. **æµ‹è¯•**: è¿è¡Œ`python test_fan_control.py`ï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ ğŸ¨âœ¨
